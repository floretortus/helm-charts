# `hlib` Helm Library

<p align="center">
  <img width="300" src="charts/hlib/img/icon.png">
</p>

## Introduction

`hlib` is a Helm chart library.
The name comes from the Ukrainian word “хліб” (bread) — a staple on every Ukrainian table — symbolizing something essential and foundational.
Just like bread in a meal, `hlib` aims to be a reliable base ingredient for building Helm-based Kubernetes deployments.

Detailed documentation for the library is here [README.md](/charts/hlib/README.md).

It is also recommended to familiarize yourself with [BEST-PRACTICES.md](/docs/BEST-PRACTICES.md) when working with helm charts.

## Getting started

### Git Configuration:

- `Chart.yaml`: To include `hlib` dependency, it is needed to add a dependencies section to this file, for example

    ```yaml
    apiVersion: v2
    description: Helm chart to deploy special service
    name: special
    version: 1.0.0
    dependencies:
      - name: hlib
        version: <desired_library_version>
        repository: https://anatolek.github.io/helm-charts
    ```

- `.helmignore`: It is important to exclude unnecessary files and directories from your chart package.
  Add it to the helm chart folder.
    <details>
    <summary>.helmignore</summary>

    ```text
    # Patterns to ignore when building packages.
    # This supports shell glob matching, relative path matching, and
    # negation (prefixed with !). Only one pattern per line.
    .DS_Store
    # Common VCS dirs
    .git/
    .gitignore
    .bzr/
    .bzrignore
    .hg/
    .hgignore
    .svn/
    # Common backup files
    *.swp
    *.bak
    *.tmp
    *.orig
    *~
    # Helm
    .helmignore
    # Various IDEs
    .project
    .idea/
    *.tmproj
    .vscode/
    ```
    </details>

- `.gitignore`: It is important to include the `charts/` in this file to avoid including unnecessary duplicate content in a git repository.
  This file is usually located in the root of the repository.

    <details>
    <summary>.gitignore</summary>

    ```text
    # .gitignore
    charts/
    ```
    </details>

- `Chart.lock`: It locks the versions of the dependencies.
  Run `helm dependency update` to generate this file. This is good practice to commit it to your Git repository.

### Template Usage

After all the settings are done, you can start using the basic templates, variables, and helper functions defined in the library.
Some examples are described in the `charts/hlib/examples/` folder.
You can take them as a basis.

### Create Helm Package

Issue the following commands to add the Helm repository that contains the library chart, and update dependencies:

```shell
helm lint <helm_chart_location>  # optionally
helm repo add hlib https://anatolek.github.io/helm-charts
helm dependency build <helm_chart_location>
helm package <helm_chart_location>
```

#### `helm dependency` commands explanation

| Command                  | Purpose                                               | Modifies `Chart.lock`? | When to Use                                                                                                                   |
|--------------------------|-------------------------------------------------------|------------------------|-------------------------------------------------------------------------------------------------------------------------------|
| `helm dependency update` | Resolves and downloads dependencies from `Chart.yaml` | ✅ Yes                 | When you want to add or change dependencies in `Chart.yaml`                                                                   |
| `helm dependency build`  | Builds the `charts/` directory from `Chart.lock`      | ❌ No                  | When you already have a `Chart.lock` and want to rebuild dependencies exactly. This usually happens through a build pipeline. |

## Contributions

### Versioning rules

Chart version contains three positions `X.Y.Z`

`Z` - should be increased **for fixes**

`Y` - should be increased for code update with **adding new features**

`X` - should be increased if update **breaks backward compatibility**

### Documentation-related changes

*README.md* chart files are generated using a [helm-docs](https://github.com/norwoodj/helm-docs/tree/master) utility.
Don't try to add changes directly.

```shell
helm-docs --skip-version-footer
```

- Add documentation on variables to `values.yaml`
- A new section should be added as a separate file to `.docs/`, and then linked into the template `README.md.gotmpl`.

### Values schema changes

The `values.schema.json` file is automatically generated by the [Helm schema plugin](https://github.com/losisin/helm-values-schema-json)

```shell
helm schema --use-helm-docs
```
